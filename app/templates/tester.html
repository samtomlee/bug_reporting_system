{% extends 'base.html' %}

{% block title %}Tester{% endblock %}
{% block header %}Tester{% endblock %}

{% block content %}
    <div class="row">
     <div class="col-md-9">
      {% include 'table.html' %}
    </div>

        <div class="col-md-3">
          <!-- Column of Developer specific functions -->
          <h4><b>Developer Functions</b></h4>
          <br>
          <form>
            <div class="form-group">
              <label for="changed-status">Bug Status</label>
              <!-- to be populated from the SQL database-->
              <select class="form-control" id="changed-status">
                {% for status in statuses %}
                <option value = "{{ status }}">{{ status}}</option>
                {% endfor %}
              </select>
            </div>
            <div class="center-block">
              <button type="button" class="btn" onclick="changeStatus()">Change Status</button>
            </div>
          </form>
          <form>
            <div class="form-group">
              <label for="changed-severity">Severity</label>
              <!-- to be populated from SQL? -->
              <select class="form-control" id="changed-severity">

              </select>
            </div>
          </form>
        </div>
      </div>
    </div>

<script>
    function changeStatus() {
      let stat = document.getElementById("changed-status");
      let toChange = document.getElementsByClassName("bugEntry");
      let promises = [];

      for (let elem of toChange) {
        if (elem.checked) {
          promises.push(
            fetch('/bug/update', {
              method: "POST",
              headers: {
                "Content-Type": 'application/json'
              },
              body: JSON.stringify({
                status: stat.value,
                bug_id: elem.value
              })
            })
          );
        }

        Promise.all(promises).then(() => {
          window.location.reload();
        });
      }
    }
  </script>
{% endblock %}
